<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>CI / CD with JavaScript</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/baloise.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/atom-one-dark.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section class="deck-slide" data-background="#E5F3F9">
            <h1>Continuous Delivery of JavaScript packages</h1>
            <h2>in an enterprise environment</h2>
        </section>
        <section class="about-slide">
            <h2>About us</h2>
            <div>
                <div class="about">
                    <img class="profile" width="250" height="250" alt="Marius" src="img/joachim-schlienger.jpeg">
                    <h3>Joachim Schlienger</h3>
                    <h3><a href="">Software Engineer @ Baloise</a></h3>
                    <h3><img width="40" style="float: left;" src="./img/Twitter_Logo_Blue.png"><a href="">@joachimschlienger</a></h3>
                </div>
                <div class="about">
                    <img class="profile" width="250" height="250" alt="Joachim" src="img/joachim-prinzbach.jpeg">
                    <h3>Joachim Prinzbach</h3>
                    <h3><a href="">Software Engineer @ Baloise</a></h3>
                    <h3><img width="40" style="float: left;" src="./img/Twitter_Logo_Blue.png"><a href="">@johaaachim</a></h3>
                </div>
            </div>
        </section>
        <section>
            <h2>About Baloise</h2>
            <h3>...</h3>
        </section>
        <section data-background="#FFFFFF">
            <h3>Our tools in Java</h3>
            <img src="img/tools.png"/>
        </section>
        <section data-background="#FFFFFF">
            <h3>Our workflow for Java artifacts</h3>
            <img src="img/workflow.png"/>
        </section>
        <section>
            <section class="deck-slide" data-background="#E5F3F9">
                <h2>Intro to NodeJS & NPM</h2>
            </section>
        </section>
        <section class="deck-slide" data-background="#E5F3F9">
            <h1>Continuous delivery concepts</h1>
        </section>
        <section>
            <section>
                <h2>Versioning and SNAPSHOTS</h2>
                <img src="img/semver.png"/>
            </section>
            <section>
                <h3>Our approach in Java</h3>
                <ul>
                    <li>not exactly semantic versioning ;-)</li>
                    <li>SNAPSHOTS!</li>
                    <li>not tagged</li>
                    <li>not stable</li>
                    <li>not reproducible</li>
                    <li>easy for development</li>
                    <li>built and published after every push on ci</li>
                </ul>
            </section>
            <section>
                <h3>Different versioning concepts in JavaScript</h3>
                <ul>
                    <li>alpha / beta prereleases</li>
                    <li>semver as best practice</li>
                    <li>prereleases are tagged and reproducible</li>
                    <li>prereleases with npm-dist-tag <span class="code">next</span></li>
                    <li>releases with npm-dist-tag <span class="code">latest</span></li>
                    <li>only build and published locally and manually</li>
                </ul>
            </section>
            <section>
                <h3>Our solution</h3>
                <h4>some picks from two worlds</h4>
                <ul>
                    <li>build and release happens on ci</li>
                    <li>prereleases built and published on push</li>
                    <li>semver to communicate changes on release</li>
                    <li>immutable artifacts</li>
                    <li>developer uses ci job to release major / minor / patch</li>
                </ul>
            </section>
            <section>
                <h4>CI live demo - Fallback</h4>
                <img src="img/prerelease_javascript.png"/>
                <img src="img/release_javascript.png"/>
            </section>
        </section>
        <section>
            <section>
                <h2>Tagging</h2>
                <h4>Know the source of your artifact</h4>
                <img src="img/tag.png"/>
            </section>
            <section>
                <h3>Our approach in Java</h3>
                <ul>
                    <li>git tag on every release by ci</li>
                </ul>
            </section>
            <section>
                <h3>Tagging in most JavaScript projects</h3>
                <ul>
                    <li>done manually and locally by a developer</li>
                </ul>
            </section>
            <section>
                <h3>Our solution</h3>
                <ul>
                    <li>git tag on every release by ci</li>
                </ul>
            </section>
        </section>
        <section>
            <section data-background="#E5F3F9">
                <h2>Release and publish</h2>
                <img src="img/release.png"/>
            </section>
            <section>
                <h3>Our approach in Java</h3>
                <ul>
                    <li>Release happens on ci</li>
                    <li>build and publish to artifact repository</li>
                    <li>artifact tagged in git -> immutable</li>
                </ul>
            </section>
            <section>
                <h3>Releasing in most JavaScript projects</h3>
                <ul>
                    <li>done manually and locally by a developer</li>
                    <li>npm-dist-tag: -> latest</li>
                    <li>published on npmjs.org</li>
                </ul>
            </section>
            <section>
                <h3>Our solution</h3>
                <ul>
                    <li>git tag on every release by ci</li>
                    <li>npm-dist-tag: -> latest</li>
                    <li>ci publishes to artifact repository</li>
                </ul>
            </section>
        </section>
        <section>
            <section data-background="#E5F3F9">
                <h3>Self contained builds</h3>
                <h4>CI job configuration in GIT, no buildtools installed on ci</h4>
                <pre>
                    <code class="hljs groovy" data-trim contenteditable>
                    pipeline {
                        agent { docker 'maven:3-alpine' }
                        stages {
                            stage('Example Build') {
                                steps {
                                    sh 'mvn -B clean verify'
                                }
                            }
                        }
                    }
                    </code>
                </pre>
            </section>
            <section>
                <h3>Our approach in Java</h3>
                <ul>
                    <li>build jobs defined in project groovy files, under version control</li>
                    <li>maven installed on CI (currently)</li>
                    <li>alternative: usage of gradle wrapper</li>
                    <li>maven or gradle as dependency manager</li>
                </ul>
            </section>
            <section>
                <h3>Most javascript projects</h3>
                <ul>
                    <li>define which Node.js version you need</li>
                    <li>container with installed version provided on ci</li>
                    <li>use package.json to define dependencies</li>
                </ul>
            </section>
            <section>
                <h3>a big corporate enterprise</h3>
                <h4>security, corporate proxy and governance</h4>
                <ul>
                    <li>not able to download any executables</li>
                    <li>or archives</li>
                    <li>or NodeJS</li>
                    <li>or npm packages</li>
                    <li>ensure an immutable history of released artifacts</li>
                </ul>
            </section>
            <section>
                <h3>Artifact repository to the rescue!</h3>
                <ul>
                    <li>can download binaries and executables</li>
                    <li>works perfectly as download manager ;-)</li>
                    <li>has our own published packages</li>
                    <li>works as proxy to the outside world -> npmjs.org</li>
                </ul>
            </section>
            <section>
                <h3>Our solution</h3>
                <h4>No NodeJS installed on CI server</h4>
                <ul>
                    <li>a project defines its required NodeJS version</li>
                    <li>that exact NodeJS version will be downloaded via artifact repository and used on CI</li>
                    <li>gradle or maven can be used to define and download</li>
                    <li>npm packages are also downloaded via artifact repository</li>
                    <li>package.json used to define all dependencies</li>
                </ul>
            </section>
            <section>
                <h3>Example using Frontend-Maven Plugin</h3>
                <pre>
                    <code class="hljs xml" data-trim contenteditable>
                        &lt;plugin>
                          &lt;groupId>com.github.eirslett&lt;/groupId>
                          &lt;artifactId>frontend-maven-plugin&lt;/artifactId>
                          &lt;executions>
                            &lt;execution>
                              &lt;id>install node&lt;/id>
                              &lt;goals>
                                &lt;goal>install-node-and-npm&lt;/goal>
                              &lt;/goals>
                              &lt;phase>generate-resources&lt;/phase>
                            &lt;/execution>
                          &lt;/executions>
                          &lt;configuration>
                            &lt;nodeVersion>v8.11.2&lt;/nodeVersion>
                            &lt;nodeDownloadRoot>${nexusNodeJS}&lt;/nodeDownloadRoot>
                          &lt;/configuration>
                        &lt;/plugin>
                    </code>
                </pre>
            </section>
        </section>
        <section>
            <section data-background="#E5F3F9">
                <h3>Build once</h3>
                <img src="img/buildonce.png"/>
            </section>
        </section>
        <section>
            <section data-background="#E5F3F9">
                <h3>Standardized process and tools</h3>
                <h4>Corporate Standard api built on best practices - freedom to adjust</h4>
                <img src="img/buildonce.png"/>
            </section>
            <section>
                <h3>Our approach in Java</h3>
                <ul>
                    <li>corporate wide maven api and workflow on CI</li>
                    <li>fully customizable for teams</li>
                </ul>
            </section>
            <section>
               <pre>
                    <code class="hljs groovy" data-trim contenteditable>
                    node {
                        stage('git checkout') {
                            checkout scm
                        }
                        stage('standard') {
                            mavenbuild()
                        }
                        stage('custom') {
                            mavenbuild cmd: "clean install",
                                       mavenArgs: "-DskipTest=true"
                        }
                    }
                    </code>
                </pre>
            </section>
            <section>
                <h3>Our solution</h3>
                <ul>
                    <li>corporate wide npm</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <h3>reproducible builds</h3>
                <h4>without SNAPSHOT dependencies</h4>
            </section>
        </section>
        <section>
            <section>
                <h3>the future</h3>
                <ul>
                    <li>security and license checks for npm packages -> IQ Server</li>
                    <li>no maven installed on ci -> fetch temporary via artifact repository</li>
                    <li>no need for maven or gradle to define and download nodejs version</li>
                    <li>-> nodejs docker img?</li>
                </ul>
            </section>
        </section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            {src: 'plugin/markdown/marked.js'},
            {src: 'plugin/markdown/markdown.js'},
            {src: 'plugin/notes/notes.js', async: true},
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });
</script>
</body>
</html>
